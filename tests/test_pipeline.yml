- name: Run all steps in the pipeline with test data using docker profile.
  tags:
    - docker
  command: nextflow run main.nf -profile docker,ci,test
  files:
    - path: "test-output/all_samples.csv"
      md5sum: b730e0899dc39a5cefd65e0513087b12
    - path: "test-output-38/variants/NA12878.vcf.gz"
      should_exist: True
    - path: "test-output-38/variants/NA12878.vcf.gz.tbi"
      should_exist: True
    - path: "test-output-38/alignments/NA12878.sorted.bam"
      should_exist: True
    - path: "test-output-38/alignments/NA12878.sorted.bai"
      should_exist: True
    - path: "test-output-38/workspace/haplocheck/NA12878-algn.raw.txt"
      contains:
        - "H13a1a1a"
        - "NA12878"
    - path: "test-output-38/workspace/haplocheck/NA12878.raw.txt"
      contains:
        - "H13a1a1a"
        - "NA12878"

- name: Run all steps in the pipeline with test data using conda profile.
  tags:
    - mamba
  command: nextflow run main.nf -profile mamba,ci,test_19
  files:
    - path: "test-output/all_samples.csv"
      md5sum: c1e79706c1e0fd883a5a28432885d191
    - path: "test-output-19/variants/NA12878.vcf.gz"
      should_exist: True
    - path: "test-output-19/variants/NA12878.vcf.gz.tbi"
      should_exist: True
    - path: "test-output-19/alignments/NA12878.sorted.bam"
      should_exist: True
    - path: "test-output-19/alignments/NA12878.sorted.bai"
      should_exist: True
    - path: "test-output-19/workspace/haplocheck/NA12878-algn.raw.txt"
      contains:
        - "H13a1a1a"
        - "NA12878"
    - path: "test-output-19/workspace/haplocheck/NA12878.raw.txt"
      contains:
        - "H13a1a1a"
        - "NA12878"
